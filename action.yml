name: Run Tracee via Docker
description: A custom action to run Aqua Security's Tracee using Docker
author: Pushkar
runs:
  using: "composite"
  steps:
    - name: Pull Tracee Docker image
      shell: bash
      run: |
        docker pull aquasec/tracee:latest

    - name: Run Tracee
      shell: bash
      run: |
        docker run --name tracee --rm -d \
            --pid=host --cgroupns=host --privileged \
            -v /etc/os-release:/etc/os-release-host:ro \
            -v /var/run:/var/run:ro \
            aquasec/tracee:latest
    
    - name: Save logs to a file
      shell: bash
      run: |
        nohup docker logs -f tracee >> tracee.log 2>&1 &
        echo $! > tracee_log.pid